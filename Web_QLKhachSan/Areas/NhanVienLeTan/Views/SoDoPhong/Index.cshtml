@model Web_QLKhachSan.Areas.NhanVienLeTan.ViewModels.SoDoPhongViewModel
@{
    ViewBag.Title = "Sơ Đồ Phòng";
    Layout = "~/Areas/NhanVienLeTan/Views/Shared/_LayoutNVLT.cshtml";
}

@section styles {
    <!-- Custom CSS for Sơ Đồ Phòng -->
    <link href="@Url.Content("~/Areas/NhanVienLeTan/Assets/css/sodoPhong.css")" rel="stylesheet" />
}

<div class="container-fluid">
 @* ==== THỐNG KÊ NHANH ==== *@
    <div class="row mb-4">
 <div class="col-md-2 col-sm-6 mb-3">
        <div class="card border-left-primary shadow h-100 py-2">
  <div class="card-body">
             <div class="row no-gutters align-items-center">
    <div class="col mr-2">
 <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Tổng phòng</div>
         <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.TongSoPhong</div>
      </div>
                   <div class="col-auto">
              <i class="fas fa-door-closed fa-2x text-gray-300"></i>
          </div>
        </div>
         </div>
            </div>
        </div>

        <div class="col-md-2 col-sm-6 mb-3">
      <div class="card border-left-success shadow h-100 py-2">
    <div class="card-body">
   <div class="row no-gutters align-items-center">
      <div class="col mr-2">
          <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Phòng trống</div>
     <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.SoPhongTrong</div>
         </div>
             <div class="col-auto">
     <i class="fas fa-door-open fa-2x text-gray-300"></i>
  </div>
       </div>
    </div>
       </div>
        </div>

        <div class="col-md-2 col-sm-6 mb-3">
            <div class="card border-left-warning shadow h-100 py-2">
       <div class="card-body">
   <div class="row no-gutters align-items-center">
          <div class="col mr-2">
<div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Đã đặt</div>
<div class="h5 mb-0 font-weight-bold text-gray-800">@Model.SoPhongDaDat</div>
             </div>
         <div class="col-auto">
          <i class="fas fa-calendar-check fa-2x text-gray-300"></i>
    </div>
           </div>
        </div>
            </div>
        </div>

     <div class="col-md-2 col-sm-6 mb-3">
            <div class="card border-left-danger shadow h-100 py-2">
                <div class="card-body">
         <div class="row no-gutters align-items-center">
         <div class="col mr-2">
     <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Đang ở</div>
    <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.SoPhongDangO</div>
  </div>
    <div class="col-auto">
             <i class="fas fa-user fa-2x text-gray-300"></i>
            </div>
      </div>
       </div>
            </div>
     </div>

    <div class="col-md-2 col-sm-6 mb-3">
    <div class="card border-left-info shadow h-100 py-2">
       <div class="card-body">
  <div class="row no-gutters align-items-center">
   <div class="col mr-2">
          <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Đang dọn</div>
 <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.SoPhongDangDon</div>
             </div>
            <div class="col-auto">
 <i class="fas fa-broom fa-2x text-gray-300"></i>
        </div>
      </div>
            </div>
    </div>
        </div>

        <div class="col-md-2 col-sm-6 mb-3">
            <div class="card border-left-secondary shadow h-100 py-2">
   <div class="card-body">
         <div class="row no-gutters align-items-center">
       <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">Tỷ lệ lấp đầy</div>
      <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.TyLeLayDay%</div>
            </div>
  <div class="col-auto">
    <i class="fas fa-chart-pie fa-2x text-gray-300"></i>
         </div>
          </div>
   </div>
      </div>
        </div>
    </div>

    @* ==== FILTERS ==== *@
    <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
       <h6 class="m-0 font-weight-bold text-primary">
      <i class="fas fa-filter"></i> Bộ lọc
     </h6>
    </div>
 <div class="card-body">
       @using (Html.BeginForm("Index", "SoDoPhong", FormMethod.Get, new { @class = "form-inline" }))
       {
     <div class="form-group mr-3 mb-2">
      <label class="mr-2">Tầng:</label>
        @Html.DropDownList("locTheoTang",
               new SelectList(Model.DanhSachTang, Model.LocTheoTang),
          "-- Tất cả --",
           new { @class = "form-control" })
    </div>

      <div class="form-group mr-3 mb-2">
         <label class="mr-2">Trạng thái:</label>
          @Html.DropDownList("locTheoTrangThai",
    new SelectList(new[]
            {
       new { Value = (byte)0, Text = "Trống" },
         new { Value = (byte)1, Text = "Đã đặt" },
      new { Value = (byte)2, Text = "Đang ở" },
 new { Value = (byte)3, Text = "Đang dọn" },
         new { Value = (byte)4, Text = "Bảo trì" }
   }, "Value", "Text", Model.LocTheoTrangThai),
     "-- Tất cả --",
   new { @class = "form-control" })
     </div>

                <div class="form-group mr-3 mb-2">
       <label class="mr-2">Loại phòng:</label>
        @Html.DropDownList("locTheoLoaiPhong",
      new SelectList(Model.DanhSachLoaiPhong, "LoaiPhongId", "TenLoai", Model.LocTheoLoaiPhong),
   "-- Tất cả --",
          new { @class = "form-control" })
           </div>

       <div class="form-group mr-3 mb-2">
           <label class="mr-2">Tìm kiếm:</label>
          @Html.TextBox("timKiem", Model.TimKiem, new { @class = "form-control", placeholder = "Mã phòng, tên phòng..." })
   </div>

      <button type="submit" class="btn btn-primary mb-2 mr-2">
            <i class="fas fa-search"></i> Lọc
             </button>

       <a href="@Url.Action("Index", "SoDoPhong")" class="btn btn-secondary mb-2">
              <i class="fas fa-sync-alt"></i> Làm mới
     </a>
 }
        </div>
    </div>

    @* ==== SƠ ĐỒ PHÒNG THEO TẦNG ==== *@
    @if (Model.DanhSachPhong != null && Model.DanhSachPhong.Any())
    {
        foreach (var tang in Model.PhongTheoTang.OrderBy(t => t.Key))
        {
          <div class="card shadow mb-4">
      <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">
     <i class="fas fa-building"></i> Tầng @tang.Key
 <span class="badge badge-secondary ml-2">@tang.Value.Count phòng</span>
       </h6>
                </div>
    <div class="card-body">
             <div class="row">
             @foreach (var phong in tang.Value)
        {
        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-3">
       <div class="card room-card h-100 shadow-sm" 
 style="border-left: 4px solid @phong.TrangThaiPhongColor; cursor: pointer;"
      onclick="xemChiTietPhong(@phong.PhongId)">
         <div class="card-body p-3">
<div class="d-flex justify-content-between align-items-center mb-2">
     <h5 class="mb-0 font-weight-bold">@phong.MaPhong</h5>
     <i class="fas @phong.TrangThaiPhongIcon fa-lg" style="color: @phong.TrangThaiPhongColor"></i>
       </div>
           <p class="mb-1 small text-muted">@phong.TenLoaiPhong</p>
        <span class="badge badge-pill" style="background-color: @phong.TrangThaiPhongColor; color: white;">
              @phong.TrangThaiPhongText
    </span>

            @if (!string.IsNullOrEmpty(phong.TenKhach))
       {
 <div class="mt-2 pt-2 border-top">
    <p class="mb-1 small"><i class="fas fa-user"></i> @phong.TenKhach</p>
          @if (phong.CheckOutHomNay)
           {
          <span class="badge badge-warning">Check-out hôm nay</span>
               }
        </div>
               }

  @if (phong.CoYeuCauDacBiet)
 {
       <div class="mt-1">
     <i class="fas fa-exclamation-circle text-warning" title="Có yêu cầu đặc biệt"></i>
     </div>
              }
                </div>
  </div>
         </div>
  }
     </div>
      </div>
         </div>
        }
    }
    else
    {
      <div class="alert alert-info">
       <i class="fas fa-info-circle"></i> Không có phòng nào phù hợp với điều kiện lọc.
        </div>
    }
</div>

@* ==== MODAL CHI TIẾT PHÒNG ==== *@
<div class="modal fade" id="modalChiTietPhong" tabindex="-1" role="dialog" aria-labelledby="modalChiTietPhongLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
           <h5 class="modal-title" id="modalChiTietPhongLabel">
 <i class="fas fa-door-open"></i> Chi tiết phòng
      </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
  </button>
      </div>
            <div class="modal-body" id="modalBody">
       <div class="text-center">
        <div class="loading-spinner"></div>
               <p class="mt-2">Đang tải thông tin phòng...</p>
                </div>
       </div>
       <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-dismiss="modal">
 <i class="fas fa-times"></i> Đóng
     </button>
       </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Custom JS for Sơ Đồ Phòng -->
    <script src="@Url.Content("~/Areas/NhanVienLeTan/Assets/js/sodoPhong.js")"></script>
}
