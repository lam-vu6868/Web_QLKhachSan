@model Web_QLKhachSan.Areas.NhanVienLeTan.ViewModels.DatPhong.DatPhongCreateViewModel
@{
    ViewBag.Title = "Tạo Đơn Đặt Phòng";
    Layout = "~/Areas/NhanVienLeTan/Views/Shared/_LayoutNVLT.cshtml";
}

@section styles {
    <link href="@Url.Content("~/Areas/NhanVienLeTan/assets/css/datphong.css")" rel="stylesheet" />
    <style>
        .room-card {
         border: 2px solid #e3e6f0;
    border-radius: 12px;
            transition: all 0.3s ease;
      cursor: pointer;
        }
    .room-card:hover {
        border-color: #4e73df;
            box-shadow: 0 4px 12px rgba(78, 115, 223, 0.2);
   }
      .room-card.selected {
    border-color: #4e73df;
    background-color: #f8f9fc;
        }
        .price-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
            border-radius: 12px;
   padding: 1.5rem;
        }
        .form-step {
       display: none;
        }
        .form-step.active {
      display: block;
}
        .step-indicator {
      display: flex;
         justify-content: space-between;
    margin-bottom: 2rem;
        }
        .step-item {
    flex: 1;
       text-align: center;
            position: relative;
        }
 .step-item:not(:last-child)::after {
   content: '';
       position: absolute;
 top: 20px;
            right: -50%;
  width: 100%;
    height: 2px;
        background: #e3e6f0;
  z-index: -1;
        }
        .step-item.completed::after {
         background: #1cc88a;
  }
        .step-number {
       width: 40px;
   height: 40px;
   border-radius: 50%;
    background: #e3e6f0;
     color: #858796;
     display: inline-flex;
       align-items: center;
            justify-content: center;
 font-weight: bold;
   margin-bottom: 0.5rem;
    }
        .step-item.active .step-number {
            background: #4e73df;
            color: white;
        }
  .step-item.completed .step-number {
 background: #1cc88a;
       color: white;
 }
    </style>
}

<div class="container-fluid">
    @* ==== HEADER ==== *@
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
       <h2 class="mb-0"><i class="fas fa-plus-circle"></i> Tạo Đơn Đặt Phòng</h2>
       <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-transparent p-0 mb-0">
          <li class="breadcrumb-item"><a href="@Url.Action("Index", "DashboardNVLT")">Dashboard</a></li>
      <li class="breadcrumb-item"><a href="@Url.Action("Index", "DatPhong")">Đặt Phòng</a></li>
            <li class="breadcrumb-item active">Tạo Mới</li>
  </ol>
      </nav>
        </div>
     <a href="@Url.Action("Index")" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Quay Lại
        </a>
    </div>

    @* ==== FORM ==== *@
    @using (Html.BeginForm("Create", "DatPhong", FormMethod.Post, new { id = "createBookingForm" }))
    {
        @Html.AntiForgeryToken()
  @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="row">
     @* ==== LEFT COLUMN: FORM ==== *@
            <div class="col-lg-8">
        <div class="card shadow mb-4">
<div class="card-body">
          @* ==== STEP INDICATOR ==== *@
      <div class="step-indicator">
            <div class="step-item active" data-step="1">
 <div class="step-number">1</div>
         <div class="step-label">Khách hàng</div>
   </div>
         <div class="step-item" data-step="2">
    <div class="step-number">2</div>
            <div class="step-label">Chọn phòng</div>
           </div>
        <div class="step-item" data-step="3">
     <div class="step-number">3</div>
<div class="step-label">Xác nhận</div>
                </div>
             </div>

    @* ==== STEP 1: THÔNG TIN KHÁCH HÀNG ==== *@
        <div class="form-step active" data-step="1">
            <h5 class="mb-3"><i class="fas fa-user"></i> Thông Tin Khách Hàng</h5>

           <div class="form-group">
          <label>Số điện thoại <span class="text-danger">*</span></label>
        <div class="input-group">
 @Html.TextBoxFor(m => m.SoDienThoai, new { @class = "form-control", placeholder = "Nhập số điện thoại...", id = "soDienThoai" })
  <div class="input-group-append">
              <button type="button" class="btn btn-primary" id="btnTimKhach">
               <i class="fas fa-search"></i> Tìm
 </button>
  </div>
                 </div>
             @Html.ValidationMessageFor(m => m.SoDienThoai, "", new { @class = "text-danger" })
  <small class="form-text text-muted">Nhập SĐT để tìm khách hàng có sẵn</small>
      </div>

             <div class="row">
             <div class="col-md-6">
                <div class="form-group">
        <label>Họ và tên <span class="text-danger">*</span></label>
        @Html.TextBoxFor(m => m.HoVaTen, new { @class = "form-control", placeholder = "Nhập họ tên..." })
        @Html.ValidationMessageFor(m => m.HoVaTen, "", new { @class = "text-danger" })
   </div>
 </div>
         <div class="col-md-6">
     <div class="form-group">
  <label>Email</label>
       @Html.TextBoxFor(m => m.Email, new { @class = "form-control", placeholder = "email@example.com", type = "email" })
  @Html.ValidationMessageFor(m => m.Email, "", new { @class = "text-danger" })
      </div>
    </div>
          </div>

   <div class="row">
                  <div class="col-md-6">
         <div class="form-group">
        <label>Giới tính</label>
       @Html.DropDownListFor(m => m.GioiTinh, new SelectList(new[] {
       new { Value = "0", Text = "Nam" },
      new { Value = "1", Text = "Nữ" },
       new { Value = "2", Text = "Khác" }
                }, "Value", "Text"), "-- Chọn giới tính --", new { @class = "form-control" })
        </div>
   </div>
    </div>

      <div class="form-group">
 <label>Địa chỉ</label>
   @Html.TextBoxFor(m => m.DiaChi, new { @class = "form-control", placeholder = "Nhập địa chỉ..." })
      </div>

          <hr />
    <h5 class="mb-3"><i class="fas fa-calendar"></i> Thông Tin Đặt Phòng</h5>

      <div class="row">
     <div class="col-md-6">
  <div class="form-group">
             <label>Ngày nhận phòng <span class="text-danger">*</span></label>
             @Html.TextBoxFor(m => m.NgayNhan, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date", id = "ngayNhan" })
      @Html.ValidationMessageFor(m => m.NgayNhan, "", new { @class = "text-danger" })
      </div>
  </div>
            <div class="col-md-6">
         <div class="form-group">
              <label>Ngày trả phòng <span class="text-danger">*</span></label>
  @Html.TextBoxFor(m => m.NgayTra, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date", id = "ngayTra" })
   @Html.ValidationMessageFor(m => m.NgayTra, "", new { @class = "text-danger" })
                </div>
             </div>
      </div>

         <div class="row">
          <div class="col-md-6">
      <div class="form-group">
  <label>Số đêm</label>
        <input type="text" class="form-control" id="soDem" value="@Model.SoDem" readonly />
         </div>
           </div>
        <div class="col-md-6">
        <div class="form-group">
            <label>Số lượng khách <span class="text-danger">*</span></label>
           @Html.TextBoxFor(m => m.SoLuongKhach, new { @class = "form-control", type = "number", min = "1", max = "50" })
        @Html.ValidationMessageFor(m => m.SoLuongKhach, "", new { @class = "text-danger" })
        </div>
   </div>
   </div>

      <div class="form-group">
        <label>Ghi chú</label>
        @Html.TextAreaFor(m => m.GhiChu, new { @class = "form-control", rows = "3", placeholder = "Yêu cầu đặc biệt (view biển, tầng cao...)" })
         </div>

     <div class="text-right">
              <button type="button" class="btn btn-primary btn-lg" id="btnNextStep1">
  Tiếp theo <i class="fas fa-arrow-right"></i>
             </button>
     </div>
      </div>

   @* ==== STEP 2: CHỌN PHÒNG ==== *@
    <div class="form-step" data-step="2">
       <h5 class="mb-3"><i class="fas fa-bed"></i> Chọn Loại Phòng</h5>

           <div id="roomList" class="row">
               @if (Model.DanhSachPhongDat != null)
    {
                for (int i = 0; i < Model.DanhSachPhongDat.Count; i++)
             {
  var phong = Model.DanhSachPhongDat[i];
         <div class="col-md-6 mb-3">
       <div class="room-card p-3" data-room-id="@phong.LoaiPhongId">
        @Html.HiddenFor(m => m.DanhSachPhongDat[i].LoaiPhongId)
         @Html.HiddenFor(m => m.DanhSachPhongDat[i].TenLoaiPhong)
     @Html.HiddenFor(m => m.DanhSachPhongDat[i].DonGia)
     @Html.HiddenFor(m => m.DanhSachPhongDat[i].SoPhongTrong)

   <div class="d-flex justify-content-between align-items-start mb-2">
           <div>
        <h6 class="mb-0">@phong.TenLoaiPhong</h6>
        <small class="text-muted">
         <i class="fas fa-users"></i> Tối đa @phong.SoNguoiToiDa người |
            <i class="fas fa-expand"></i> @phong.DienTich m²
        </small>
     </div>
 <span class="badge badge-success">@phong.SoPhongTrong phòng trống</span>
  </div>

       <p class="text-muted small mb-2">@phong.MoTa</p>

 <div class="d-flex justify-content-between align-items-center">
    <div>
          <strong class="text-primary">@phong.DonGia.ToString("N0") đ</strong>
     <small class="text-muted">/đêm</small>
   </div>
          <div class="input-group" style="width: 120px;">
     <div class="input-group-prepend">
              <button type="button" class="btn btn-sm btn-outline-secondary btn-decrease" data-index="@i">-</button>
       </div>
    @Html.TextBoxFor(m => m.DanhSachPhongDat[i].SoLuong, new { @class = "form-control form-control-sm text-center room-quantity", type = "number", min = "0", max = phong.SoPhongTrong, data_index = i })
      <div class="input-group-append">
              <button type="button" class="btn btn-sm btn-outline-secondary btn-increase" data-index="@i" data-max="@phong.SoPhongTrong">+</button>
   </div>
       </div>
         </div>
     </div>
             </div>
          }
        }
         </div>

 <div class="d-flex justify-content-between mt-3">
         <button type="button" class="btn btn-secondary" id="btnPrevStep2">
        <i class="fas fa-arrow-left"></i> Quay lại
           </button>
<button type="button" class="btn btn-primary btn-lg" id="btnNextStep2">
  Tiếp theo <i class="fas fa-arrow-right"></i>
     </button>
         </div>
       </div>

  @* ==== STEP 3: XÁC NHẬN ==== *@
        <div class="form-step" data-step="3">
          <h5 class="mb-3"><i class="fas fa-check-circle"></i> Xác Nhận Đặt Phòng</h5>

 <div class="card mb-3">
        <div class="card-body">
            <h6><i class="fas fa-user"></i> Thông Tin Khách Hàng</h6>
             <div id="customerSummary"></div>
        </div>
     </div>

           <div class="card mb-3">
         <div class="card-body">
          <h6><i class="fas fa-bed"></i> Phòng Đã Chọn</h6>
      <div id="roomSummary"></div>
          </div>
  </div>

       <div class="form-group">
 <label>Mã khuyến mãi</label>
           <div class="input-group">
          @Html.TextBoxFor(m => m.MaKhuyenMai, new { @class = "form-control", placeholder = "Nhập mã khuyến mãi..." })
         <div class="input-group-append">
       <button type="button" class="btn btn-outline-primary" id="btnApDungKM">
    Áp dụng
       </button>
    </div>
          </div>
      <small id="kmMessage" class="form-text"></small>
      </div>

     <div class="form-group">
    <label>Hình thức thanh toán</label>
      @Html.DropDownListFor(m => m.HinhThucThanhToan, new SelectList(new[] {
                 new { Value = "0", Text = "Tiền mặt" },
 new { Value = "1", Text = "Chuyển khoản" },
  new { Value = "2", Text = "QR Code" }
          }, "Value", "Text"), "-- Chọn hình thức --", new { @class = "form-control" })
            </div>

  <div class="form-group">
      <label>Đặt cọc trước (VNĐ)</label>
               @Html.TextBoxFor(m => m.TienDatCoc, new { @class = "form-control", type = "number", min = "0", placeholder = "Nhập số tiền đặt cọc..." })
           <small class="form-text text-muted">Khuyến nghị: 30% tổng tiền</small>
      </div>

              <div class="d-flex justify-content-between mt-4">
            <button type="button" class="btn btn-secondary" id="btnPrevStep3">
        <i class="fas fa-arrow-left"></i> Quay lại
          </button>
    <button type="submit" class="btn btn-success btn-lg" id="btnSubmit">
      <i class="fas fa-save"></i> Lưu Đơn Đặt Phòng
     </button>
            </div>
          </div>
    </div>
       </div>
     </div>

            @* ==== RIGHT COLUMN: SUMMARY ==== *@
  <div class="col-lg-4">
                <div class="card shadow mb-4 sticky-top" style="top: 20px;">
   <div class="price-summary">
       <h5 class="text-white mb-3"><i class="fas fa-calculator"></i> Tổng Tiền</h5>

        <div class="d-flex justify-content-between mb-2">
         <span>Tổng tiền phòng:</span>
     <strong id="tongTienPhong">0 đ</strong>
     </div>

     <div class="d-flex justify-content-between mb-2">
            <span>Giảm giá:</span>
  <strong id="tienGiamGia">0 đ</strong>
       </div>

     <div class="d-flex justify-content-between mb-2">
     <span>Thuế VAT (10%):</span>
     <strong id="thueVAT">0 đ</strong>
              </div>

    <hr style="border-color: rgba(255,255,255,0.3);" />

               <div class="d-flex justify-content-between">
  <h5 class="text-white mb-0">TỔNG CỘNG:</h5>
         <h4 class="text-white mb-0" id="tongCong">0 đ</h4>
             </div>
  </div>
       </div>

             <div class="card shadow">
          <div class="card-body">
   <h6 class="text-primary"><i class="fas fa-info-circle"></i> Lưu Ý</h6>
     <ul class="small text-muted mb-0">
         <li>Giờ nhận phòng: 14:00</li>
      <li>Giờ trả phòng: 12:00</li>
                 <li>Đặt cọc tối thiểu: 30%</li>
      <li>Hủy phòng miễn phí trước 24h</li>
    </ul>
 </div>
          </div>
    </div>
  </div>
    }
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="@Url.Content("~/Areas/NhanVienLeTan/assets/js/datphong-create.js")"></script>
}
