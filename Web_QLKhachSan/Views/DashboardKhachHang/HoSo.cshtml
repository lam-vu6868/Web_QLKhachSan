@model Web_QLKhachSan.Models.RangBuocHoSoViewModel
@{
    ViewBag.Title = "Thông Tin Cá Nhân";
}
<link rel="stylesheet" href="~/assets/css/dashboard-khachhang.css" />

<section class="dashboard-hero">
    <div class="container">
        <div class="welcome-card">
            <div class="welcome-content">
                <h1>Xin Chào, <span id="welcomeName">@(Session["HoVaTen"])</span>! 👋</h1>
                <p>Chào mừng trở lại với The Serene Horizon Hotel</p>
            </div>
            <div class="welcome-actions">
                <a href="@Url.Action("Index", "PhongNghi")" class="btn-primary">
                    <i class="fas fa-plus"></i> Đặt Phòng Mới
                </a>
            </div>
        </div>
    </div>
</section>

<section class="dashboard-main">
    <div class="container">
        <div class="dashboard-layout">

            <div class="dashboard-content">

                <section id="profile" class="content-section">
                    <h2 class="section-title">Thông Tin Cá Nhân</h2>

                    <div class="profile-layout">
                        <div class="profile-card">
                            <div class="profile-header">
                                <div class="profile-avatar">
                                    <img src="@(!string.IsNullOrEmpty(Session["AnhDaiDienUrl"] as string) ? Session["AnhDaiDienUrl"] : Url.Content("~/assets/images/default-avatar.png"))" 
                                         alt="Avatar" 
                                         id="avatarImage" 
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                                    <i class="fas fa-user-circle" style="display: none;"></i>
                                    <div class="avatar-overlay" onclick="document.getElementById('avatarUpload').click()">
                                        <i class="fas fa-camera"></i>
                                    </div>
                                    <input type="file" id="avatarUpload" accept="image/*" style="display: none;" onchange="uploadAvatar(this)" />
                                </div>
                                <div class="profile-info">
                                    <h3 id="profileName">@(Session["HoVaTen"])</h3>
                                    <span class="member-badge">
                                        <i class="fas fa-crown"></i> Thành Viên VIP
                                    </span>
                                </div>
                            </div>

                            <!-- Phần Thay Đổi Mật Khẩu -->
                            <div class="password-section">
                                <h4><i class="fas fa-lock"></i> Bảo Mật Tài Khoản</h4>
                                <button type="button" class="btn-change-password" onclick="showChangePasswordForm()">
                                    <i class="fas fa-key"></i> Đổi Mật Khẩu
                                </button>
                            </div>

                            <!-- Form Đổi Mật Khẩu (Ẩn mặc định) -->
                            <div class="change-password-form" id="changePasswordForm" style="display: none;">
                                <div class="password-form-header">
                                    <h5><i class="fas fa-shield-alt"></i> Thay Đổi Mật Khẩu</h5>
                                    <button type="button" class="btn-close-form" onclick="hideChangePasswordForm()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                
                                @using (Html.BeginForm("DoiMatKhau", "DashboardKhachHang", FormMethod.Post, new { id = "changePasswordFormSubmit" }))
                                {
                                    @Html.AntiForgeryToken()
                                    <div class="password-form-body">
                                        <div class="form-group-password">
                                            @Html.LabelFor(m => m.MatKhauHienTai, new { @class = "" })
                                            <div class="password-input-wrapper">
                                                @Html.PasswordFor(m => m.MatKhauHienTai, new { 
                                                    @class = "form-control", 
                                                    placeholder = "Nhập mật khẩu hiện tại",
                                                    id = "MatKhauHienTai"
                                                })
                                                <button type="button" class="toggle-password" onclick="togglePasswordVisibility('MatKhauHienTai')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                            @Html.ValidationMessageFor(m => m.MatKhauHienTai, "", new { @class = "text-danger validation-error" })
                                        </div>

                                        <div class="form-group-password">
                                            @Html.LabelFor(m => m.MatKhauMoi, new { @class = "" })
                                            <div class="password-input-wrapper">
                                                @Html.PasswordFor(m => m.MatKhauMoi, new { 
                                                    @class = "form-control", 
                                                    placeholder = "Nhập mật khẩu mới",
                                                    id = "MatKhauMoi"
                                                })
                                                <button type="button" class="toggle-password" onclick="togglePasswordVisibility('MatKhauMoi')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                            <small class="password-hint">
                                                <i class="fas fa-info-circle"></i> Tối thiểu 8 ký tự, bao gồm chữ hoa, chữ thường và số
                                            </small>
                                            @Html.ValidationMessageFor(m => m.MatKhauMoi, "", new { @class = "text-danger validation-error" })
                                            
                                            <!-- Password Strength Indicator -->
                                            <div class="password-strength">
                                                <div class="strength-bar">
                                                    <div class="strength-level" id="strengthLevel"></div>
                                                </div>
                                                <span class="strength-text" id="strengthText">Độ mạnh: Chưa nhập</span>
                                            </div>
                                        </div>

                                        <div class="form-group-password">
                                            @Html.LabelFor(m => m.XacNhanMatKhauMoi, new { @class = "" })
                                            <div class="password-input-wrapper">
                                                @Html.PasswordFor(m => m.XacNhanMatKhauMoi, new { 
                                                    @class = "form-control", 
                                                    placeholder = "Nhập lại mật khẩu mới",
                                                    id = "XacNhanMatKhauMoi"
                                                })
                                                <button type="button" class="toggle-password" onclick="togglePasswordVisibility('XacNhanMatKhauMoi')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                            @Html.ValidationMessageFor(m => m.XacNhanMatKhauMoi, "", new { @class = "text-danger validation-error" })
                                        </div>

                                        <div class="password-form-actions">
                                            <button type="button" class="btn-cancel" onclick="hideChangePasswordForm()">
                                                <i class="fas fa-times"></i> Hủy
                                            </button>
                                            <button type="submit" class="btn-confirm-password">
                                                <i class="fas fa-check"></i> Xác Nhận Đổi
                                            </button>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>

                        <div class="profile-form-card">
                            <h3>Cập Nhật Thông Tin</h3>

                            <!-- Form Họ và Tên -->
                            <div class="form-section">
                                <div class="form-group-inline">
                                    <label for="fullName"><i class="fa-solid fa-user"></i> Họ và Tên</label>
                                    <div class="input-with-button">
                                        <input type="text" id="fullName" value="@(Session["HoVaTen"])" readonly />
                                        <button type="button" class="btn-edit" onclick="editField('fullName')">
                                            <i class="fas fa-edit"></i> Đổi Tên
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Form Số Điện Thoại -->
                            <div class="form-section">
                                <div class="form-group-inline">
                                    <label for="phone"><i class="fa-solid fa-phone"></i> Số Điện Thoại</label>
                                    <div class="input-with-button">
                                        <input type="tel" id="phone" value="@(Session["SoDienThoai"] ?? "")" placeholder="Chưa có số điện thoại" readonly />
                                        <button type="button" class="btn-edit" onclick="editField('phone')">
                                            <i class="fas fa-phone"></i> @(Session["SoDienThoai"] != null ? "Đổi SĐT" : "Thêm SĐT")
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Form Ngày Sinh -->
                            <div class="form-section">
                                <div class="form-group-inline">
                                    <label for="birthdate"><i class="fa-solid fa-calendar"></i> Ngày Sinh</label>
                                    <div class="input-with-button">
                                        <input type="date"
                                               id="birthdate"
                                               value="@(Session["NgaySinh"] != null ? ((DateTime)Session["NgaySinh"]).ToString("yyyy-MM-dd") : "")"
                                               readonly />
                                        <button type="button" class="btn-edit" onclick="editField('birthdate')">
                                            <i class="fas fa-calendar"></i> Đổi Ngày Sinh
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Form Địa Chỉ -->
                            <div class="form-section">
                                <div class="form-group-inline">
                                    <label for="address"><i class="fa-solid fa-location-dot"></i> Địa Chỉ</label>
                                    <div class="input-with-button">
                                        <textarea id="address" rows="3" placeholder="Chưa có địa chỉ" readonly>@(Session["DiaChi"] ?? "")</textarea>
                                        <button type="button" class="btn-edit" onclick="editField('address')">
                                            <i class="fas fa-map-marker-alt"></i> @(Session["DiaChi"] != null ? "Đổi Địa Chỉ" : "Thêm Địa Chỉ")
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Nút Lưu Thay Đổi (Chung) -->
                            <div class="form-section">
                                <button type="button" class="btn-primary btn-save-all" onclick="saveAllChanges()">
                                    <i class="fas fa-save"></i> Lưu Thay Đổi
                                </button>
                            </div>
                        </div>
                </section>
            </div>
        </div>
    </div>
</section>

@section scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/assets/js/dashboard-khachhang.js"></script>
}