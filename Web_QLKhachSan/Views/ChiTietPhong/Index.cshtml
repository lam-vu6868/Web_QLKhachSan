@model Web_QLKhachSan.Models.Phong

@{
    ViewBag.Title = (Model != null ? Model.TenPhong : "Chi Tiết") + " - Chi Tiết Phòng";
}
<link rel="stylesheet" href="~/assets/css/chi-tiet-phong.css" />

@if (Model == null)
{
    <div class="container" style="padding: 100px 0;">
        <div style="max-width: 800px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h2 style="color: #d4af37;">⚠️ Debug Information</h2>

            @if (ViewBag.ErrorMessage != null)
            {
                <div style="background: #fee; border-left: 4px solid #f00; padding: 15px; margin: 20px 0;">
                    <strong>Error:</strong> @ViewBag.ErrorMessage
                </div>
            }

            <div style="background: #f9f9f9; padding: 15px; margin: 20px 0; border-radius: 5px;">
                <p><strong>Tổng số LoaiPhong trong database:</strong> @ViewBag.TotalLoaiPhongs</p>
                <p><strong>ID được yêu cầu:</strong> @ViewBag.RequestedId</p>
                <p><strong>Các ID có sẵn trong database:</strong> @ViewBag.AllIds</p>
            </div>

            @if (ViewBag.StackTrace != null)
            {
                <details style="margin: 20px 0;">
                    <summary style="cursor: pointer; color: #d4af37; font-weight: bold;">Stack Trace</summary>
                    <pre style="background: #f5f5f5; padding: 10px; overflow: auto; font-size: 12px;">@ViewBag.StackTrace</pre>
                </details>
            }

            <div style="text-align: center; margin-top: 30px;">
                <a href="@Url.Action("Index", "PhongNghi")" style="display: inline-block; padding: 12px 30px; background: #d4af37; color: white; text-decoration: none; border-radius: 5px; font-weight: bold;">
                    ← Quay lại danh sách phòng
                </a>
            </div>
        </div>
    </div>
    return;
}

<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <div class="breadcrumb">
            <a href="@Url.Action("Index", "PhongNghi")">Phòng nghỉ</a>
            <i class="fas fa-chevron-right"></i>
            <span>Chi tiết phòng</span>
        </div>
        <h1 data-aos="fade-up">@Model.TenPhong</h1>
        <div class="room-badges" data-aos="fade-up" data-aos-delay="100">
            <span class="badge premium">@Model.MaPhong</span>
            <span class="badge view">@Model.LoaiPhong.TenLoai</span>
            <span class="badge rating">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                5.0
            </span>
        </div>
    </div>
</section>

<!-- Main Content -->
<main class="main-content">
    <div class="container">
        <div class="room-layout">
            <!-- Image Gallery -->
            <div class="gallery-section" data-aos="fade-right">
                <div class="main-gallery">
                    @{
                        var phongAnhs = Model.PhongAnhs != null && Model.PhongAnhs.Any()
                            ? Model.PhongAnhs.OrderBy(pa => pa.ThuTu).ToList()
                            : new List<Web_QLKhachSan.Models.PhongAnh>();
                        var firstImage = phongAnhs.FirstOrDefault()?.Url ?? Model.HinhAnhThumb ?? "https://images.unsplash.com/photo-1611892440504-42a792e24d32?auto=format&fit=crop&w=1740&q=80";
                    }
                    <div class="gallery-main">
                        <img src="@firstImage"
                             alt="@Model.TenPhong - Main"
                             id="main-image" />
                        <div class="gallery-controls">
                            <button class="gallery-btn prev" id="prev-btn">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="gallery-btn next" id="next-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="gallery-indicators" id="gallery-indicators"></div>
                    </div>

                    <div class="gallery-thumbnails" id="gallery-thumbnails">
                        @if (phongAnhs.Any())
                        {
                            for (int i = 0; i < phongAnhs.Count; i++)
                            {
                                var phongAnh = phongAnhs[i];
                                var activeClass = i == 0 ? "active" : "";
                                <div class="thumbnail @activeClass" data-src="@phongAnh.Url">
                                    <img src="@phongAnh.Url" alt="@(phongAnh.ChuThich ?? Model.TenPhong + " - View " + (i + 1))" />
                                </div>
                            }
                        }
                        else
                        {
                            @* Fallback images nếu không có ảnh trong database *@
                            <div class="thumbnail active" data-src="@firstImage">
                                <img src="@firstImage" alt="@Model.TenPhong - View 1" />
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Room Information -->
            <div class="room-info-section" data-aos="fade-up">
                <div class="room-info-content">
                    <div class="room-header">
                        <div class="room-title">
                            <h2>@Model.TenPhong</h2>
                            <p class="room-subtitle">@Model.LoaiPhong.TenLoai - @(Model.LoaiPhong.MoTa ?? "Không gian sang trọng")</p>
                        </div>
                        @{
                            var giaPhong = Model.Gia ?? Model.LoaiPhong.GiaCoBan;
                        }
                        @if (giaPhong.HasValue)
                        {
                            <div class="room-price">
                                <span class="price-amount">@giaPhong.Value.ToString("N0")₫</span>
                                <span class="price-unit">/ đêm</span>
                            </div>
                        }
                    </div>
                    <!-- Booking Section -->
                    <div class="booking-section" data-aos="fade-up">
                        <div class="booking-container">
                            <div class="booking-info">
                                <h3>Sẵn sàng đặt phòng?</h3>
                                <p>Trải nghiệm kỳ nghỉ tuyệt vời với dịch vụ 5 sao và tầm nhìn đại dương tuyệt đẹp</p>
                            </div>
                            <button type="button" class="btn-book-now-main">
                                <i class="fas fa-calendar-check"></i>
                                Đặt Phòng Ngay
                            </button>
                        </div>
                    </div>

                    <div class="room-features">
                        @if (Model.LoaiPhong.DienTich.HasValue)
                        {
                            <div class="feature-item">
                                <i class="fas fa-ruler-combined"></i>
                                <span>@Model.LoaiPhong.DienTich.Value.ToString("0")m²</span>
                            </div>
                        }
                        @if (Model.LoaiPhong.SoNguoiToiDa.HasValue)
                        {
                            <div class="feature-item">
                                <i class="fas fa-users"></i>
                                <span>@Model.LoaiPhong.SoNguoiToiDa Khách</span>
                            </div>
                        }
                        @foreach (var tienIch in Model.LoaiPhong.TienIches.Take(4))
                        {
                            var iconClass = !string.IsNullOrEmpty(tienIch.Icon) ? tienIch.Icon : "fas fa-star";
                            <div class="feature-item">
                                <i class="@iconClass"></i>
                                <span>@tienIch.TenTienIch</span>
                            </div>
                        }
                    </div>

                    @*<div class="room-description">
                        <p>@Html.Raw(Model.LoaiPhong.MoTa ?? "Tận hưởng không gian nghỉ dưỡng tuyệt vời với thiết kế tinh tế và nội thất cao cấp.")</p>
                    </div>*@
                </div>


            </div>
        </div>

        <!-- Amenities Section -->
        <div class="amenities-section" data-aos="fade-up">
            <h3 class="section-title">Tiện nghi phòng</h3>
            @if (Model.LoaiPhong.TienNghis != null && Model.LoaiPhong.TienNghis.Any())
            {
                <div class="amenities-grid">
                    @{
                        var tienNghiGroups = Model.LoaiPhong.TienNghis
                            .GroupBy(tn => tn.LoaiTienNghi != null ? tn.LoaiTienNghi.TenLoai : "Tiện nghi khác");
                    }
                    @foreach (var group in tienNghiGroups)
                    {
                        var firstIcon = group.FirstOrDefault()?.Icon;
                        var groupIconClass = !string.IsNullOrEmpty(firstIcon) ? firstIcon : "fas fa-star";
                        <div class="amenity-category">
                            <h4><i class="@groupIconClass"></i> @group.Key</h4>
                            <ul>
                                @foreach (var tienNghi in group)
                                {
                                    <li>@tienNghi.TenTienNghi</li>
                                }
                            </ul>
                        </div>
                    }
                </div>
            }
            else
            {
                <p>Thông tin tiện nghi sẽ được cập nhật sớm.</p>
            }
        </div>

        <!-- Similar Rooms -->
        <div class="similar-rooms-section" data-aos="fade-up">
            <h3 class="section-title">Phòng tương tự</h3>
            <div class="rooms-carousel">
                @if (ViewBag.SimilarRooms != null && ((List<Web_QLKhachSan.Models.Phong>)ViewBag.SimilarRooms).Any())
                {
                    foreach (var room in (List<Web_QLKhachSan.Models.Phong>)ViewBag.SimilarRooms)
                    {
                        var roomImage = room.PhongAnhs != null && room.PhongAnhs.Any()
                            ? room.PhongAnhs.OrderBy(pa => pa.ThuTu).FirstOrDefault()?.Url
                            : room.HinhAnhThumb ?? "https://images.unsplash.com/photo-1611892440504-42a792e24d32?auto=format&fit=crop&w=800&q=80";
                        var roomPrice = room.Gia ?? room.LoaiPhong.GiaCoBan ?? 0;
                        var roomTag = room.LoaiPhong.TenLoai ?? "Phòng";
                        <div class="room-card">
                            <div class="room-image">
                                <img src="@roomImage" alt="@room.TenPhong" />
                                <div class="room-tag">@roomTag</div>
                            </div>
                            <div class="room-info">
                                <h4>@room.TenPhong</h4>
                                <p class="room-price">@roomPrice.ToString("N0")₫ <span>/ đêm</span></p>
                                <div class="room-features">
                                    @if (room.LoaiPhong.DienTich.HasValue)
                                    {
                                        <span><i class="fas fa-ruler-combined"></i> @room.LoaiPhong.DienTich.Value.ToString("0")m²</span>
                                    }
                                    @if (room.LoaiPhong.SoNguoiToiDa.HasValue)
                                    {
                                        <span><i class="fas fa-users"></i> @room.LoaiPhong.SoNguoiToiDa khách</span>
                                    }
                                </div>
                                <a href="@Url.Action("Index", "ChiTietPhong", new { id = room.PhongId })" class="btn-view-room">Xem chi tiết</a>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <p style="text-align: center; color: #999; padding: 40px 0;">Không có phòng tương tự</p>
                }
            </div>
        </div>
    </div>
</main>

<script src="~/assets/js/chi-tiet-phong.js"></script>

