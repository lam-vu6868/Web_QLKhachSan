@model Web_QLKhachSan.Models.DanhGiaIndexViewModel
@{
    ViewBag.Title = "Đánh Giá Khách Hàng";
}
<link rel="stylesheet" href="~/assets/css/danh-gia.css" />

<main>
    <section class="hero-section">
        <div class="hero-content">
            <div class="container">
                <div class="hero-text" data-aos="fade-up">
                    <h1>Trải Nghiệm Đẳng Cấp</h1>
                    <p>Khám phá những câu chuyện và cảm nhận chân thực từ các vị khách đã trải nghiệm dịch vụ tại The Serene Horizon</p>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <span class="stat-number" data-count="@Model.SoDanhGia">0</span>
                            <span class="stat-label">Đánh giá</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" data-count="@Model.TongDiem">0</span>
                            <span class="stat-label">Điểm trung bình</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" data-count="@Model.PhanTramHaiLong">0</span>
                            <span class="stat-label">% Hài lòng</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="hero-decoration">
            <div class="floating-card" data-aos="fade-right" data-aos-delay="200">
                <i class="fas fa-star"></i>
                <span>Dịch vụ xuất sắc</span>
            </div>
            <div class="floating-card" data-aos="fade-left" data-aos-delay="400">
                <i class="fas fa-heart"></i>
                <span>Trải nghiệm tuyệt vời</span>
            </div>
            <div class="floating-card" data-aos="fade-up" data-aos-delay="600">
                <i class="fas fa-crown"></i>
                <span>Đẳng cấp 5 sao</span>
            </div>
        </div>
    </section>

    <section class="rating-summary">
        <div class="summary-grid">
            <div class="overall-card" data-aos="fade-right">
                <div class="overall-score-center">
                    <div class="score-badge-large" style="--score: @((Model.TongDiem / 5.0) * 100)">
                        <span>@Model.TongDiem</span>
                    </div>
                    <h2 class="section-heading">
                        Tổng Điểm Hài Lòng
                    </h2>
                    <div class="star-row">
                        @{
                            var fullStars = (int)Math.Floor(Model.TongDiem);
                            var hasHalfStar = (Model.TongDiem - fullStars) >= 0.5;
                            
                            for (int i = 0; i < fullStars; i++)
                            {
                                <i class="fas fa-star"></i>
                            }
                            if (hasHalfStar)
                            {
                                <i class="fas fa-star-half-alt"></i>
                            }
                            for (int i = fullStars + (hasHalfStar ? 1 : 0); i < 5; i++)
                            {
                                <i class="far fa-star" style="color: #e2e8f0;"></i>
                            }
                        }
                    </div>
                    <div class="score-note">
                        Dựa trên @Model.SoDanhGia.ToString("#,##0") đánh giá đã xác minh
                    </div>
                </div>
            </div>

            <aside class="aside-card" data-aos="fade-left">
                <div class="card-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <h3>Trải nghiệm kỳ nghỉ trong mơ</h3>
                <div class="feature-highlights">
                    <div class="highlight-item">
                        <i class="fas fa-star"></i>
                        <span>Dịch vụ 5 sao</span>
                    </div>
                    <div class="highlight-item">
                        <i class="fas fa-gift"></i>
                        <span>Ưu đãi đặc biệt</span>
                    </div>
                    <div class="highlight-item">
                        <i class="fas fa-clock"></i>
                        <span>Phục vụ 24/7</span>
                    </div>
                </div>
                <p>
                    Tận hưởng không gian đẳng cấp, dịch vụ tận tâm và những khoảnh
                    khắc trọn vẹn. Đặt phòng ngay hôm nay để không bỏ lỡ ưu đãi đặc
                    biệt.
                </p>
                <a class="cta-inline" href="@Url.Action("Index", "PhongNghi")">
                    <span>Khám phá phòng</span>
                    <i class="fas fa-arrow-right"></i>
                </a>
            </aside>
        </div>
    </section>

    <section class="reviews-section" data-current-user-email="@Model.EmailKhachHang" data-current-user-name="@Model.TenKhachHang">
        <div class="container">
            <div class="section-header" data-aos="fade-up">
                <h2>Khách Hàng Nói Gì Về Chúng Tôi</h2>
                <p>Những câu chuyện và trải nghiệm chân thực từ các vị khách đã tin tương và lựa chọn The Serene Horizon</p>
            </div>

            <div class="reviews-controls" data-aos="fade-up" data-aos-delay="150">
                <div class="reviews-filter">
                    <button id="filterAll" class="filter-btn active" data-filter="all">Tất cả</button>
                    @if (!string.IsNullOrEmpty(Model.EmailKhachHang))
                    {
                        <button id="filterMine" class="filter-btn" data-filter="mine">Của tôi</button>
                    }
                </div>
            </div>

            <div class="reviews-grid" data-aos="fade-up" data-aos-delay="200">
                @foreach (var danhGia in Model.DanhSachDanhGia)
                {
                    var khachHang = danhGia.KhachHang;
                    var avatarUrl = string.IsNullOrEmpty(khachHang.AnhDaiDienUrl) 
                        ? "https://www.gravatar.com/avatar/?d=mp&s=150" + (khachHang.MaKhachHang % 70 + 1) 
                        : khachHang.AnhDaiDienUrl;
                    var ngayDanhGia = (DateTime.Now - danhGia.NgayTao).Days;
                    var timeAgo = ngayDanhGia == 0 ? "Hôm nay" : 
                                  ngayDanhGia == 1 ? "1 ngày trước" : 
                                  ngayDanhGia < 7 ? ngayDanhGia + " ngày trước" :
                                  ngayDanhGia < 30 ? (ngayDanhGia / 7) + " tuần trước" :
                                  (ngayDanhGia / 30) + " tháng trước";
                    
                    <div class="review-card" data-email="@khachHang.Email">
                        <div class="review-header">
                            <div class="reviewer-avatar">
                                <img src="@avatarUrl" alt="@khachHang.HoVaTen">
                            </div>
                            <div class="reviewer-info">
                                <h4>@khachHang.HoVaTen</h4>
                                <div class="review-date">@timeAgo</div>
                            </div>
                        </div>
                        <div class="review-rating">
                            <div class="stars">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= danhGia.Diem)
                                    {
                                        <i class="fas fa-star"></i>
                                    }
                                    else
                                    {
                                        <i class="fas fa-star" style="color: #e2e8f0;"></i>
                                    }
                                }
                            </div>
                            <span class="rating-score">@danhGia.Diem/5</span>
                        </div>
                        <div class="review-content">@danhGia.BinhLuan</div>
                        @if (danhGia.DanhGiaHinhAnhs != null && danhGia.DanhGiaHinhAnhs.Any())
                        {
                            <div class="review-images">
                                @foreach (var img in danhGia.DanhGiaHinhAnhs)
                                {
                                    <div class="review-image-item">
                                        <img src="@img.DuongDanAnh" alt="Review image">
                                    </div>
                                }
                            </div>
                        }
                        <div class="review-service">@danhGia.Phong.TenPhong</div>
                    </div>
                }
            </div>

            <!-- Pagination -->
            <div class="pagination-wrapper" data-aos="fade-up" data-aos-delay="300" data-current-page="@Model.CurrentPage" data-total-pages="@Model.TotalPages">
                <button class="pagination-btn pagination-prev" data-page="@(Model.CurrentPage - 1)" @(Model.CurrentPage <= 1 ? "disabled" : "")>
                    <i class="fas fa-chevron-left"></i>
                </button>
                
                <div class="pagination-numbers">
                    @for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        if (i == 1 || i == Model.TotalPages || (i >= Model.CurrentPage - 1 && i <= Model.CurrentPage + 1))
                        {
                            <button class="pagination-number @(i == Model.CurrentPage ? "active" : "")" data-page="@i">@i</button>
                        }
                        else if (i == Model.CurrentPage - 2 || i == Model.CurrentPage + 2)
                        {
                            <span class="pagination-dots">...</span>
                        }
                    }
                </div>
                
                <button class="pagination-btn pagination-next" data-page="@(Model.CurrentPage + 1)" @(Model.CurrentPage >= Model.TotalPages ? "disabled" : "")>
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </section>

    @if (!string.IsNullOrEmpty(Model.EmailKhachHang))
    {
        <section class="write-review-section">
            <div class="container">
                <div class="review-form-wrapper" data-aos="fade-up">
                    <div class="form-header">
                        <h3>Chia Sẻ Trải Nghiệm Của Bạn</h3>
                        <p>Đánh giá của bạn sẽ giúp chúng tôi cải thiện dịch vụ và hỗ trợ khách hàng khác đưa ra quyết định tốt hơn</p>
                    </div>

                    @using (Html.BeginForm("ThemDanhGia", "DanhGia", FormMethod.Post, new { @class = "modern-review-form", id = "reviewForm", enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken()
                    
                    <div class="form-row-grid">
                        <div class="form-group">
                            <label for="reviewerName">
                                <i class="fas fa-user"></i>
                                Tên Khách hàng
                            </label>
                            <input type="text" id="reviewerName" readonly value="@Model.TenKhachHang" placeholder="Vui lòng đăng nhập">
                        </div>

                        <div class="form-group">
                            <label for="PhongId">
                                <i class="fas fa-bed"></i>
                                Chọn phòng đã đặt
                            </label>
                            @Html.DropDownList("PhongId", Model.DanhSachPhong, "-- Chọn phòng --", new { @class = "form-control"})
                            @Html.ValidationMessage("PhongId", "", new { @class = "text-danger" })

                        </div>
                    </div>

                    <div class="form-row-grid">
                        <div class="form-group">
                            <label for="BinhLuan">
                                <i class="fas fa-edit"></i>
                                Nội dung Bình luận
                            </label>
                            @Html.TextArea("BinhLuan", "", 4, 0, new { @class = "form-control", placeholder = "Hãy chia sẻ chi tiết về trải nghiệm của bạn tại The Serene Horizon..." })
                            @Html.ValidationMessage("BinhLuan", "", new { @class = "text-danger" })
                        </div>

                        <div class="form-group">
                            <label>
                                <i class="fas fa-star"></i>
                                Điểm (Sao)
                            </label>
                            <input type="hidden" id="Diem" name="Diem" value="0"/>
                            <div class="star-rating" data-category="overall">
                                <i class="fas fa-star" data-value="1"></i>
                                <i class="fas fa-star" data-value="2"></i>
                                <i class="fas fa-star" data-value="3"></i>
                                <i class="fas fa-star" data-value="4"></i>
                                <i class="fas fa-star" data-value="5"></i>
                            </div>
                            <span class="rating-text">Chọn số sao</span>
                            @Html.ValidationMessage("Diem", "", new { @class = "text-danger" })
                        </div>
                    </div>                    <div class="form-group photo-upload">
                        <label>
                            <i class="fas fa-camera"></i>
                            Ảnh đính kèm (nếu có)
                        </label>
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-placeholder">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Kéo thả hình ảnh vào đây hoặc <span class="upload-link">chọn file</span></p>
                                <small>Tối đa 5 hình, mỗi hình không quá 5MB</small>
                            </div>
                            <input type="file" id="photoInput" name="AnhDanhGia" multiple accept="image/*" hidden>
                        </div>
                        <div class="photo-preview" id="photoPreview"></div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="resetForm">
                            <i class="fas fa-undo"></i>
                            Đặt lại
                        </button>
                        <button type="submit" class="btn-primary" id="submitReview">
                            <i class="fas fa-paper-plane"></i>
                            Gửi đánh giá
                        </button>
                    </div>
                }
            </div>
        </div>
    </section>
    }

    <!-- Toast notifications -->
    <div class="toast-container" id="toastContainer"></div>
</main>

<script src="~/assets/js/danh-gia.js"></script>

